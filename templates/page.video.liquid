<div class="row">
    <div class="col-12 padding-0">
        <header class="section__head">
            <img src="{{ 'header4.png' | asset_url }}" data-was-processed="true">
            <div class="section__head-inner">
                <div class="textwrap align-bottom">
                    <h1 class="section__title">{{ page.title }}</h1><!-- /.section__title -->
                </div>
            </div><!-- /.section__head-inner -->
        </header>
    </div>
</div>
<div class="row justify-content-center page">
    <div class="col-12 col-md-8 mt-3 mb-4">
        <div class="embed-responsive embed-responsive-16by9">
            <div id="video_info"></div>
            <video id="remoteVideo" autoplay controls playsinline style="display:none;"></video>
            <img id="play_button" src="{{ 'dotted.png' | asset_url }}" onclick="playVideo()" width="75" height="59" style="position:absolute;top:10px;left:10px;display:none;" />
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
    // document.getElementById("video_info").innerHTML="Stream will start playing automatically<br/>when it is live";

    var streamId = "569332473288465303990438";


    function playVideo() {
        document.getElementById("remoteVideo").style.display = "block";
        document.getElementById("remoteVideo").play().then(function(value) {
            //autoplay started
            document.getElementById("play_button").style.display = "none";
        }).catch(function(error) {
            //
            document.getElementById("play_button").style.display = "block";
            console.log("User interaction needed to start playing");
        });

    }

    function startPlaying() {
        webRTCAdaptor.play(streamNameBox.value);
    }

    function stopPlaying() {
        webRTCAdaptor.stop();
    }

    var pc_config = null;

    var sdpConstraints = {
        OfferToReceiveAudio: true,
        OfferToReceiveVideo: true

    };
    var mediaConstraints = {
        video: false,
        audio: false
    };

    var appName = location.pathname.substring(0, location.pathname.lastIndexOf("/") + 1);
    var path = location.hostname + ":" + location.port + appName + "websocket";
    var websocketURL = "ws://" + path;

    if(location.protocol.startsWith("https")) {
        websocketURL = "wss://" + path;
    }

    var webRTCAdaptor = new WebRTCAdaptor({
        websocket_url: "wss://vid.whoamedia.com:5443/WebRTCAppEE/websocket",
        mediaConstraints: mediaConstraints,
        peerconnection_config: pc_config,
        sdp_constraints: sdpConstraints,
        remoteVideoId: "remoteVideo",
        isPlayMode: true,
        debug: true,
        callback: function(info, description) {
            if(info == "initialized") {
                console.log("initialized");
                webRTCAdaptor.getStreamInfo(streamId);
            } else if(info == "streamInformation") {
                console.log("stream information");
                webRTCAdaptor.play(streamId);
            } else if(info == "play_started") {
                //joined the stream
                console.log("play started");
                document.getElementById("video_info").style.display = "none";
                playVideo();
            } else if(info == "play_finished") {
                //leaved the stream
                console.log("play finished");
                //check that publish may start again
                setTimeout(function() {
                    webRTCAdaptor.getStreamInfo(streamId);
                }, 3000);
            } else if(info == "closed") {
                //console.log("Connection closed");
                if(typeof description != "undefined") {
                    console.log("Connecton closed: " + JSON.stringify(description));
                }
            }

        },
        callbackError: function(error) {
            //some of the possible errors, NotFoundError, SecurityError,PermissionDeniedError

            console.log("error callback: " + JSON.stringify(error));

            if(error == "no_stream_exist") {
                setTimeout(function() {
                    webRTCAdaptor.getStreamInfo(streamId);
                }, 3000);
            }
            // alert(JSON.stringify(error));
        }
    });

});
</script>