{% capture end %}{{ collection.metafields.dailydeal.switched_at |  date: "%Y/%m"  }}/{{ collection.metafields.dailydeal.switched_at |  date: "%d" | plus: 7  }}{% endcapture %}
{% capture deal %}{{ collection.metafields.dailydeal.dailydeal }}{% endcapture %}
{% capture is_test %}{% if collection.metafields.dailydeal.dailydeal contains "test_primary_m" or collection.metafields.dailydeal.dailydeal contains "test_primary_f" %}true{% endif %}{% endcapture %}
{% if is_test == 'true' %}
  {% capture end %}{{ collection.metafields.dailydeal.switched_at |  date: "%Y/%m"  }}/{{ collection.metafields.dailydeal.switched_at |  date: "%d"  | plus: 1  }}{% endcapture %}
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
  var endParts = '{{ end }}'.split('/');
  var endDate = new Date(endParts[0], endParts[1] - 1, endParts[2]);
  endDate.setHours(12, 0, 0, 0);

  var fmt = {% if collection.metafields.dailydeal.dailydeal contains "deal6" %}'%H:%M:%S'{% else %}'%-D days %H:%M:%S'{% endif %};

  if (window.startCountdown) {
    startCountdown('{{ deal }}', endDate, fmt, {
      expiredText: '',
      onFinish: function(){ document.querySelectorAll('.time-left').forEach(function(el){ el.style.display='none'; }); },
      onUpdate: function(){ document.querySelectorAll('.time-left').forEach(function(el){ el.style.display=''; }); }
    });
  }
});
</script>
<span id="{{ collection.metafields.dailydeal.dailydeal }}"></span>